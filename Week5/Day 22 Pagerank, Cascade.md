# Day 22 Pagerank, Cascade

# 페이지 랭크 : 투표 관점

- 페이지랭크의 핵심 아이디어는 투표
- 투표를 통해 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾는 것
- 투표의 주체는 웹페이지이고, 웹페이지는 하이퍼링크를 통해 투표를 한다
- 들어오는 간선이 많을 수록 신뢰할 수 있다는 의미
- 하지만 간선의 수를 부풀려, 조작을 할 수 있다는 문제가 있다
- 이런 악용을 막기 위해, 페이지랭크에서는 가중 투표를 한다
- 측정하려는 웹페이지의 관련성 및 신뢰도를 페이지랭크 점수라고 할 때, 각 웹페이지의 페이지랭크 점수는 받은 투표의 가중치 합으로 정의됨
- 페이지랭크 점수는 다음과 같이 정의됨
    - $r_j = \sum_{i\in N_{in}(j)} \frac{r_i}{d_{out}(i)}$
- 연립방정식을 통해 풀 수 있음

# 페이지 랭크 : 임의 보행 관점

- 페이지랭크는 임의 보행(Random Walk)의 관점에서도 정의 가능
- 웹서퍼는 현재 웹페이지에 있는 하이퍼링크 중 하나를 균일한 확률로 클릭하는 방식으로 서핑할때,
- 웹서퍼가 t번째 방문한 웹페이지가 웹페이지 i일 확률을 $p_i(t)$라고 한다
- 그러면 $p(t)$는 길이가 웹페이지 수와 같은 확률분포 벡터가 된다
- $p_j(t+1) = \sum_{i\in N_{in}(j)} \frac{p_i(t)}{d_{out}(i)}$
- t가 무한히 커지면, 확률 분포 $p(t)$는 수렴하게 된다
- $p(t) = p(t+1) = p$ 가 성립하게 되고, 수렴한 확률 분포 $p$는 정상 분포(Statinary Distribution)이라고 부른다
- 그러면 위의 식을 $p_j = \sum_{i\in N_{in}(j)} \frac{p_i}{d_{out}(i)}$ 로 바꿀 수 있다
- 즉 투표 관점에서 정의한 페이지 랭크 점수는 임의 보행 관점에서의 정상 분포와 동일하다

# 페이지 랭크의 계산

- 페이지랭크 점수의 계산에는 반복곱(Power Iteration)을 사용한다
    1. 각 웹페이지 $i$의 페이지랭크 점수 $r^{(0)}_i$를 동일하게 $\frac{1}{웹페이지의 수}$로 초기화한다
    2. 아래 식을 이용하여 각 웹페이지의 페이지랭크 점수를 갱신한다
        - $r_j^{(t+1)} = \sum_{i\in N_{in}(j)} \frac{r_i^{(t)}}{d_{out}(i)}$
    3. 페이지랭크 점수가 수렴하였으면 종료한다. 아닌 경우 2. 로 돌아간다

    ![Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled.png](Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled.png)

- 반복곱이 항상 수렴하는 것은 아니다
    - 들어오는 간선은 있지만 나가는 간선이 없는 정점 집합인 스파이더 트랩(Spider Trap)에 의한 문제

        ![Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%201.png](Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%201.png)

- 반복곱이 합리적인 점수로 수렴하는 것을 보장할 수는 없다
    - 들어오는 간선은 있지만 나가는 간선은 없는 막다른 정점(Dead End)에 의한 문제

        ![Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%202.png](Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%202.png)

- 문제 해결을 위해 순간이동(Teleport)를 도입한다
    1. 현재 웹페이지에 하이퍼링크가 없다면, 임의의 웹페이지로 순간이동 한다
    2. 현제 웹페이지에 하이퍼링크가 있다면, 앞면이 나올 확률이 $\alpha$인 동전을 던진다
    3. 앞면이라면, 하이퍼링크 중 하나를 균일한 확률로 선택해 클릭한다
    4. 뒷면이라면, 임의의 웹페이지로 순간이동 한다
    - 1. 과 4. 의 임의의 웹페이지는 전체 웹페이지들 중에 하나를 균일확률로 선택한다
    - 순간이동에 의해서 스파이더 트랩이나 막다른 정점에 갇히는 일이 없어짐
    - $\alpha$를 감폭 비율(Damping Factor)이라고 부르며 값으로 보통 0.8 정도를 사용함
- 순간이동 도입은 페이지랭크 점수 계산을 다음과 같이 바꾼다
    1. 각 막다른 정점에서(자신을 포함) 모든 다른 정점으로 가는 간선을 추가한다
    2. 아래 수식을 사용하여 반복곱을 수행함
    - $r_j = \sum_{i\in N_{in}(j)} (\alpha\frac{r_i}{d_{out}(i)}) + (1-\alpha)\frac{1}{|V|}$
        - $|V|$는 전체 웹페이지의 수를 의미함
        - 첫번째 항은 하이퍼링크를 따라 정점 $j$에 도착할 확률을 의미함
        - 두번째 항은 순간이동을 통해 정점 $j$에 도착할 확률을 의미함

# 그래프를 통한 전파

- 온라인 소셜 네트워크를 통해 다양한 정보, 행동이 전파
- 파워그리드의 정전, 네트워크의 고장이 전파 되는 과정
- 사회라는 네트워크를 통한 질병의 전파 등이 있다
- 전파 과정은 다양할 뿐 아니라 매우 복잡하다
- 이를 체계쩍으로 이해하고 대처하기 위해서는 수학적 모형화가 필요하다

# 의사결정 기반의 전파 모형

- 의사결정을 고려하여 각자 의사결정을 내리는 경우에 의사결정 기반의 전파 모형을 사용함
- 가장 간단한 형태의 의사결정 기반의 전파 모형인 선형 임계치 모형(Linear Threshold Model)을 소개한다

## 선형 임계치 모형

- $p$ 비율의 이웃이 $A$를 선택했다고 할 때, $1-p$ 비율의 이웃이 $B$를 선택했다
- 정점 $u$는 언제 $A$를 선택할까?
    - $ap > b(1-p)$ 일 때 $A$를 선택한다
        - 정리하면 $p > \frac{b}{a+b}$일 때이다
        - 이때 $\frac{b}{a+b}$를 임계치 $q$라고 한다

        ![Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%203.png](Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%203.png)

- 이 모형을 선형 임계치 모형이라 한다
- 각 정점은 이웃 중 $A$를 선택한 비율이 임계치 $q$를 넘을 때만 $A$를 선택한다
- 처음 $A$를 선택한 집단을 시드 집합(Seed Set)이라고 한다

# 확률적 전파 모형

- 코로나의 전파 과정을 수학적으로 추상화해보자
- 코로나의 전파는 확률적 과정이기 때문에 확률적 전파 모형을 고려해야 한다
- 가장 간단한 형태의 확률적 전파 모형인 독립 전파 모형(Independent Cascade Model)을 소개한다

## 독립적 전파 모형

- 방향성이 있고 가중치가 있는 그래프를 가정한다
- 각 간선 $(u,v)$의 가중치 $p_{uv}$는 $u$가 감염되었을 때(그리고 $v$가 감염되지 않았을 때) $u$가 $v$를 감염시킬 확률에 해당한다
- 즉, 각 정점 $u$가 감염될 때마다, 각 이웃 $v$는 $p_{uv}$확률로 전염된다

![Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%204.png](Day%2022%20Pagerank,%20Cascade%20643eda29d6df4c31b02d94c24dbcfcd3/Untitled%204.png)

- 서로 다른 이웃이 전염되는 확률은 독립적이다
- 이전 모형과 마찬가지로 첫 감염자들을 시드 집합(Seed Set)이라고 부른다
- 감염자는 계속 감염자 상태로 남아 있는 것을 가정한다
    - 감염자의 회복을 가정하는 SIS, SIR 등의 다른 전파 모형도 있다

# 바이럴 마케팅과 전파 최대화 문제

- 바이럴 마케팅이 효과적이기 위해서는 소문의 시작점이 중요하다
    - 시작점이 어디인지에 따라 입소문이 전파되는 범위가 영향을 받기 때문
- 시드 집합을 우리가 선택할 수 있다면, 누구를 선택해야 할까?
- 그래프, 전파 모형, 그리고 시드 집합의 크기가 주어졌을 때 전파를 최대화하는 시드 집합을 찾는 문제를 전파 최대화(Influence Maximization) 문제라고 부른다
- 전파 최대화 문제는 굉장히 어려운 문제
    - 그래프에 $|V|$개의 정점이 있을 경우, 시드 집합의 크기를 k일 때, 경우의 수는 $|V| \choose k$개 이다
    - 이론적으로 많은 전파 모형에 대하여 전파 최대화 문제는 NP-hard임이 증명 되었음
    - 근사 알고리즘을 사용해야 한다
- 대표적으로 휴리스틱으로 정점의 중심성(Node Centrality)을 사용한다
    - 시드 집합 크기가 k개 일때, 정점의 중심성이 높은 순으로 k개 정점 선택하는 방법
    - 정점의 중심성으로는 페이지랭크 점수, 연결 중심성, 근접 중심성, 매개 중심성 등이 있다
    - 합리적인 방법이지만, 최고의 시드 집합을 찾는다는 보장은 없다
- 탐욕 알고리즘(Greedy Algorithm) 역시 많이 사용된다
    - 탐욕 알고리즘은 시드 집합의 원소, 즉 최초 전파자를 한번에 한 명씩 선택함
    - 정점의 집합을 $\{1,2,...,|V|\}$라고 할 때,
        - 집합 $\{1\},\{2\},...\{|V|\}$를 비교하여, 전파를 최대화하는 시드 집합을 찾는다
        - 이때, 전파의 크기를 비교하기 위해 시뮬레이션을 반복하여 평균 값을 사용한다
        - 뽑힌 집합을 $\{x\}$라고 할 때,
        - 집합 $\{x,1\},\{x,2\},...,\{x,|V|\}$를 비교하여, 전파를 최대화 하는 시드 집합을 찾는다
        - 위 과정을 목표하는 크기의 시드 집합에 도달할 때까지 반복한다
    - 즉, 탐욕 알고리즘은 최초 전파자 간의 조합의 효과를 고려하지 않고 근시안적으로 최초 전파자를 선택하는 과정을 반복한다
    - 독립 전파 모형의 경우, 이론적으로 정확도가 일부 보장됨
        - 입력 그래프와 무관하게 항상 다음 부등식이 성립한다
        - 탐욕 알고리즘으로 찾은 시드 집합의 의한 전파의(평균) 크기

            $\ge(1-\frac{1}{e})\ *$ 최고의 시드 집합에 의한 전파의(평균) 크기

            $\approx 0.632\ *$ 최고의 시드 집합에 의한 전파의(평균) 크기

        - 즉, 탐욕 알고리즘의 최저 성능은 수학적으로 보장되어 있음